<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ASCII Forest Roguelike</title>
  <style>
    :root {
      --bg: #0b0b0b;
      --fg: #e8e6df;
      --accent: #7bd389;   /* trees */
      --player: #ffd166;   /* player */
      --floor: #6b7280;    /* ground */
      --herb: #a8e6cf;     /* medicinal herb */
      --water: #5bc0eb;    /* water */
      --panel: #151515;
      --border: #2a2a2a;
      --btn: #1b1b1b;
      --btnBorder: #333;
      --btnHover: #262626;
      --overlay: rgba(0,0,0,0.75);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      display: grid;
      place-items: center;
      background: var(--bg);
      color: var(--fg);
      font-family: monospace;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 10px;
    }

    .wrap { display: grid; gap: 12px; }

    #grid, #invGrid {
      --size: 19;
      display: grid;
      grid-template-columns: repeat(var(--size), 1em);
      grid-auto-rows: 1em;
      gap: 0;
      font-size: 22px;
      line-height: 1;
      user-select: none;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      background: #0e0e0e;
    }
    #grid span, #invGrid span { width: 1em; height: 1em; display: inline-block; text-align: center; }
    .tree { color: var(--accent); }
    .player { color: var(--player); font-weight: bold; }
    .floor { color: var(--floor); }
    .herb { color: var(--herb); font-weight: bold; }
    .water { color: var(--water); font-weight: bold; }

    .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; align-items: start; }
    .dpad { display: grid; grid-template-columns: repeat(3, 48px); grid-template-rows: repeat(3, 48px); gap: 6px; width: max-content; }
    .dpad .spacer { visibility: hidden; }
    .actions { display: flex; justify-content: flex-end; align-items: flex-start; gap: 10px; flex-wrap: wrap; }

    button { background: var(--btn); color: var(--fg); border: 1px solid var(--btnBorder); border-radius: 10px; padding: 10px 14px; cursor: pointer; font: inherit; touch-action: manipulation; }
    button:hover { background: var(--btnHover); }
    .btn-big { padding: 12px 18px; border-radius: 12px; }

    .modal { position: fixed; inset: 0; display: none; place-items: center; background: var(--overlay); z-index: 1000; }
    .modal[open] { display: grid; }
    .modal-panel { background: #0e0e0e; border: 1px solid var(--border); border-radius: 12px; padding: 10px; }
    .top-bar { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 6px; }
    .pill { border: 1px solid var(--btnBorder); background: var(--panel); padding: 6px 10px; border-radius: 999px; font-size: 12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="grid" aria-label="Forest realm" role="application"></div>
    <div class="controls" aria-label="Controls">
      <div class="dpad" id="dpad">
        <span class="spacer"></span>
        <button data-dx="0" data-dy="-1">↑</button>
        <span class="spacer"></span>
        <button data-dx="-1" data-dy="0">←</button>
        <span class="spacer"></span>
        <button data-dx="1" data-dy="0">→</button>
        <span class="spacer"></span>
        <button data-dx="0" data-dy="1">↓</button>
        <span class="spacer"></span>
      </div>
      <div class="actions">
        <button id="actionBtn" class="btn-big">Action</button>
        <button id="backpackBtn" class="btn-big">Backpack</button>
      </div>
    </div>
  </div>

  <div class="modal" id="invModal">
    <div class="modal-panel">
      <div class="top-bar">
        <span class="pill" id="invSummary">Inventory</span>
        <button id="closeInv">Close</button>
      </div>
      <div id="invGrid"></div>
    </div>
  </div>

  <script>
    const SIZE = 19;
    const GROUND = 0, TREE = 1, HERB = 2, WATER = 3;
    const TREE_DENSITY = 0.28;
    const HERB_DENSITY = 0.04;
    const WATER_CLUSTERS = 4; // number of water bodies
    const WATER_CLUSTER_SIZE = 10; // random walk steps per cluster

    let grid = [];
    const player = { x: Math.floor(SIZE / 2), y: Math.floor(SIZE / 2) };
    const inventory = { herb: 0 };

    function generate() {
      grid = Array.from({ length: SIZE }, () => Array(SIZE).fill(GROUND));
      const cx = Math.floor(SIZE / 2), cy = Math.floor(SIZE / 2);

      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
          const dx = Math.abs(x - cx), dy = Math.abs(y - cy);
          const inClearing = dx <= 1 && dy <= 1;
          if (!inClearing && Math.random() < TREE_DENSITY) grid[y][x] = TREE;
        }
      }

      carveGlades(cx, cy, 120);
      placeWaterBodies(WATER_CLUSTERS, WATER_CLUSTER_SIZE);

      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
          if (grid[y][x] === GROUND && Math.random() < HERB_DENSITY) grid[y][x] = HERB;
        }
      }

      player.x = cx; player.y = cy; if (grid[cy][cx] !== GROUND && grid[cy][cx] !== HERB) grid[cy][cx] = GROUND;
      render();
    }

    function carveGlades(x, y, steps) {
      for (let i = 0; i < steps; i++) {
        if (grid[y][x] === TREE) grid[y][x] = GROUND;
        const dir = Math.floor(Math.random() * 4);
        if (dir === 0 && y > 0) y--;
        else if (dir === 1 && x < SIZE - 1) x++;
        else if (dir === 2 && y < SIZE - 1) y++;
        else if (dir === 3 && x > 0) x--;
      }
    }

    function placeWaterBodies(count, steps) {
      for (let i = 0; i < count; i++) {
        let x = Math.floor(Math.random() * SIZE);
        let y = Math.floor(Math.random() * SIZE);
        for (let s = 0; s < steps; s++) {
          if (grid[y][x] === GROUND) grid[y][x] = WATER;
          const dir = Math.floor(Math.random() * 4);
          if (dir === 0 && y > 0) y--;
          else if (dir === 1 && x < SIZE - 1) x++;
          else if (dir === 2 && y < SIZE - 1) y++;
          else if (dir === 3 && x > 0) x--;
        }
      }
    }

    function tryMove(dx, dy) {
      const nx = player.x + dx, ny = player.y + dy;
      if (nx < 0 || ny < 0 || nx >= SIZE || ny >= SIZE) return;
      if (grid[ny][nx] === TREE || grid[ny][nx] === WATER) return;
      player.x = nx; player.y = ny;
      render();
    }

    function cellHTML(x, y) {
      if (player.x === x && player.y === y) return '<span class="player">@</span>';
      switch (grid[y][x]) {
        case TREE: return '<span class="tree">∆</span>';
        case HERB: return '<span class="herb">v</span>';
        case WATER: return '<span class="water">~</span>';
        default: return '<span class="floor">·</span>';
      }
    }

    function render() {
      const el = document.getElementById('grid');
      const out = [];
      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) out.push(cellHTML(x, y));
      }
      el.innerHTML = out.join('');
      updateInvSummary();
    }

    function doAction() {
      const {x, y} = player;
      if (grid[y][x] === HERB) {
        grid[y][x] = GROUND;
        inventory.herb += 1;
        render();
      }
    }

    const invModal = document.getElementById('invModal');
    const invGrid = document.getElementById('invGrid');

    function openInventory() { renderInventoryGrid(); invModal.setAttribute('open', ''); }
    function closeInventory() { invModal.removeAttribute('open'); }
    function updateInvSummary() { document.getElementById('invSummary').textContent = `INVENTORY`; }

    function renderInventoryGrid() {
      const buf = Array.from({length: SIZE}, () => Array(SIZE).fill(' '));
      const write = (x, y, text) => { for (let i = 0; i < text.length && x + i < SIZE; i++) buf[y][x + i] = text[i]; };
      write(0, 0, 'INVENTORY');
      write(0, 2, `Medicinal Herb: ${inventory.herb}`);
      write(0, 4, '(Press Close to return)');
      const out = [];
      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) out.push(`<span class="floor">${buf[y][x]}</span>`);
      }
      invGrid.innerHTML = out.join('');
    }

    document.addEventListener('keydown', e => {
      const keyMap = { 'ArrowUp':[0,-1], 'ArrowDown':[0,1], 'ArrowLeft':[-1,0], 'ArrowRight':[1,0], 'w':[0,-1], 'a':[-1,0], 's':[0,1], 'd':[1,0], 'W':[0,-1], 'A':[-1,0], 'S':[0,1], 'D':[1,0] };
      if (keyMap[e.key]) { e.preventDefault(); const [dx, dy] = keyMap[e.key]; tryMove(dx, dy); }
      else if (e.key === ' ') { e.preventDefault(); doAction(); }
      else if (e.key === 'b' || e.key === 'B') { e.preventDefault(); openInventory(); }
      else if (e.key === 'Escape' && invModal.hasAttribute('open')) { closeInventory(); }
    });

    document.getElementById('dpad').addEventListener('click', e => { const btn = e.target.closest('button[data-dx]'); if (!btn) return; tryMove(parseInt(btn.dataset.dx, 10), parseInt(btn.dataset.dy, 10)); });
    document.getElementById('actionBtn').addEventListener('click', doAction);
    document.getElementById('backpackBtn').addEventListener('click', openInventory);
    document.getElementById('closeInv').addEventListener('click', closeInventory);
    invModal.addEventListener('click', e => { if (e.target === invModal) closeInventory(); });

    generate();
  </script>
</body>
</html>
